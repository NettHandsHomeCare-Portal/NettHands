FROM ubuntu:22.04
ARG DEBIAN_FRONTEND=noninteractive
RUN echo 'APT::Install-Suggests "0";' >> /etc/apt/apt.conf.d/00-docker
RUN echo 'APT::Install-Recommends "0";' >> /etc/apt/apt.conf.d/00-docker
RUN apt-get update && \
    apt-get upgrade --yes

RUN apt install curl \
sudo \ 
micro --yes

RUN sudo apt install lsb-release  gpg

RUN curl -fsSL https://packages.redis.io/gpg | sudo gpg --dearmor -o /usr/share/keyrings/redis-archive-keyring.gpg


RUN sudo apt-get install --reinstall systemd

RUN curl --proto '=https' --tlsv1.2 -sSf https://sh.vector.dev | sh -s -- -y

RUN mkdir /etc/vector & mkdir /var/lib/vector/


COPY --chown=reportable_base_user ./vector.service /etc/systemd/system/vector.service


COPY --chown=nhhc_app nhhc/ /src/app/
RUN ./init.sh

RUN useradd --create-home reportable_base_user
USER reportable_base_user

ENTRYPOINT ["source" "${VIRTUALENV}/bin/activate" , "&&", "python", "/src/app/manage.py","runserver", "0.0.0.0:1357" ]
